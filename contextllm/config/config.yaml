# ============================================================
# Context LLM 통합 설정 파일
# CLI 인자로 덮어쓸 수 있습니다 (CLI > config.yaml > 기본값)
# ============================================================

# -----------------------------------------------------------
# API 키 설정
# 방법 1: 여기에 직접 입력 (간편)
# 방법 2: config/.env 파일에 OPENAI_API_KEY=sk-... 형식으로 입력
# 방법 3: 환경변수로 설정 (export OPENAI_API_KEY=sk-...)
# 우선순위: 환경변수 > .env 파일 > config.yaml
# -----------------------------------------------------------
api_keys:
  openai: ""  # 여기에 OpenAI API 키 입력 (예: sk-...)
  # google: ""  # Google Cloud API 키 (향후 사용)

# -----------------------------------------------------------
# 기본 설정
# -----------------------------------------------------------
mode: realtime  # realtime, testset, file, webcam, network
model: gpt-4o-mini  # gpt-4o-mini, gpt-4o, gpt-4-turbo

# -----------------------------------------------------------
# 비디오 소스 설정
# -----------------------------------------------------------
video:
  camera_id: 0                    # 웹캠 ID
  testset_path: testsets          # 테스트셋 폴더 경로
  network_url: ""                 # 네트워크 카메라 URL (rtsp://, http://)
  file_path: ""                   # 분석할 파일 경로

# -----------------------------------------------------------
# 다운샘플링 설정 (성능 최적화)
# -----------------------------------------------------------
downsampling:
  max_image_size: 640             # 최대 이미지 크기 (픽셀)
  jpeg_quality: 75                # JPEG 압축 품질 (1-100)
  video_fps: 2.0                  # 비디오 분석 FPS
  max_video_frames: 10            # 최대 프레임 수
  video_capture_duration: 5.0     # 캡처 시간 (초)

# -----------------------------------------------------------
# 분석 설정
# -----------------------------------------------------------
analysis:
  default_text: ""                # 기본 텍스트 입력 (음성 대신)
  iterations: null                # 반복 횟수 (null = 무한)
  analyze_all_testset: false      # 테스트셋 전체 분석 여부
  testset_index: null             # 테스트셋에서 분석할 파일 인덱스

# -----------------------------------------------------------
# 로깅 설정
# -----------------------------------------------------------
logging:
  save_results: true              # 결과 저장 여부
  log_dir: data/logs              # 로그 저장 경로
  verbose: false                  # 상세 로그 출력

# -----------------------------------------------------------
# 프롬프트 설정
# -----------------------------------------------------------
prompts:
  # 시스템 프롬프트 (멀티모달 분석용)
  system: |
    당신은 음성과 이미지를 함께 분석하는 상황 분석 AI입니다. 객관적으로 상황을 파악하고 분석하세요.

    ⚠️ 특히 다음의 긴급 키워드와 시각적 신호에 주의하세요:

    **음성 긴급 키워드:**
    - "살려줘", "도와줘", "긴급", "119", "경찰", "신고", "침입", "도움", "위험", "피해", "사고", "화재", "폭발", "공격"

    **시각적 긴급 신호:**
    - 화재, 연기, 불꽃
    - 침입자, 의심스러운 인물
    - 쓰러진 사람, 부상
    - 위험한 상황
    - 혼란스러운 장면, 파괴된 환경

    **멀티모달 분석 원칙:**
    1. 음성과 시각 정보가 일치하는지 확인
    2. 한쪽만 위험 신호가 있어도 주의 깊게 판단
    3. 시각 정보로 음성 내용의 진위 검증
    4. 컨텍스트를 종합하여 전체 상황 파악

    다음을 JSON으로만 반환하세요 (다른 텍스트 없이):
    {
      "context": "음성과 이미지를 종합한 맥락 설명",
      "urgency": "위급도 (낮음/중간/높음/긴급 중 하나)",
      "urgency_reason": "왜 그 위급도인지 간단히 설명",
      "situation": "상황을 2-3줄로 상세히 분석",
      "situation_type": "상황 유형 (업무/긴급/의료응급/보안/일상/정보요청/불만/기타 등)",
      "emotional_state": "감정 상태 (긍정/중립/부정/공포/절박/분노 등)",
      "visual_content": "이미지/비디오에서 관찰된 내용 요약",
      "audio_visual_consistency": "음성과 시각 정보의 일치도 (일치/불일치/부분일치)",
      "action": "권장 즉시 조치",
      "is_emergency": true 또는 false,
      "emergency_reason": "긴급 판정 이유 (긴급이 아니면 null)",
      "priority": "우선순위 (CRITICAL/HIGH/MEDIUM/LOW 중 하나)"
    }

    📌 긴급(CRITICAL) 판정 기준:
    - 신체 위협 (음성 또는 시각)
    - 재난 징후 (화재, 폭발, 붕괴 등)
    - 범죄 현장 (침입, 강도, 폭행 등)
    - 의료 응급 (쓰러진 사람, 부상, 심한 출혈 등)
    - 기타 극도의 위험 상황

  # 긴급 키워드 목록
  emergency_keywords:
    - 살려줘
    - 도와줘
    - 긴급
    - "119"
    - 경찰
    - 신고
    - 침입
    - 도움
    - 위험
    - 피해
    - 사고
    - 화재
    - 폭발
    - 공격

# -----------------------------------------------------------
# 음성 특성 분석 설정
# -----------------------------------------------------------
voice_analysis:
  # 샘플링 레이트
  sample_rate: 16000
  
  # 피치 분석 임계값
  pitch:
    high_threshold: 250           # 이 이상이면 높은 피치로 판정 (Hz)
    variability_threshold: 50     # 피치 변동성 임계값
  
  # 에너지 분석 임계값
  energy:
    normalization_factor: 0.5     # 에너지 정규화 계수
    volatility_threshold: 0.3     # 에너지 변동성 임계값
  
  # 음성 속도 임계값
  speech_rate:
    normal_max: 6                 # 일반적인 최대 속도 (음절/초)
    fast_threshold: 6             # 빠른 속도 임계값
  
  # 유성음 비율 임계값
  voiced_ratio:
    low_threshold: 0.3            # 이 이하면 비명/샤우팅으로 판정
  
  # 지터/시머 임계값 (음성 떨림)
  jitter_shimmer:
    jitter_threshold: 0.1         # 지터 임계값
    shimmer_threshold: 0.1        # 시머 임계값

  # 최종 점수 계산 가중치
  scoring:
    llm_weight: 0.6               # LLM 분석 가중치
    voice_weight: 0.4             # 음성 특성 가중치
    
  # 우선순위 임계값
  priority_thresholds:
    critical: 0.85                # CRITICAL 임계값
    high: 0.65                    # HIGH 임계값
    medium: 0.40                  # MEDIUM 임계값

# -----------------------------------------------------------
# OpenAI API 설정
# -----------------------------------------------------------
openai:
  max_tokens: 800                 # 최대 응답 토큰 수
  temperature: 0.3                # 응답 다양성 (0-1)
  image_detail: low               # 이미지 분석 상세도 (low/high/auto)
  timeout: 30                     # API 타임아웃 (초)
